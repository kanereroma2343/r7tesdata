<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Page</title>
    <link rel="stylesheet" href="styles.css"> <!-- Link to your CSS file -->
    <script>
        // Function to show the success modal
        function showSuccessModal() {
            const modal = document.getElementById('successModal');
            const overlay = document.getElementById('overlay');
            modal.style.display = 'block';
            overlay.style.display = 'block';
        }

        // Function to close the modal
        function closeModal() {
            const modal = document.getElementById('successModal');
            const overlay = document.getElementById('overlay');
            modal.style.display = 'none';
            overlay.style.display = 'none';
            loadUploadedFiles(); // Refresh the list of uploaded files after a successful upload
        }

        // Function to handle form submission via Fetch API
        async function handleFormSubmit(event) {
            event.preventDefault(); // Prevent the default form submission

            const form = document.querySelector('form');
            const formData = new FormData(form);

            try {
                const response = await fetch(form.action, {
                    method: form.method,
                    body: formData
                });

                if (response.ok) {
                    // Show the success modal if the upload is successful
                    showSuccessModal();
                } else {
                    alert('Upload failed. Please try again.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            }
        }

        // Function to load and display uploaded files
        async function loadUploadedFiles() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = ''; // Clear current list

            try {
                const response = await fetch('/api/list-files');
                const files = await response.json();

                files.forEach(file => {
                    const listItem = document.createElement('li');
                    listItem.textContent = file;
                    fileList.appendChild(listItem);
                });
            } catch (error) {
                console.error('Error loading files:', error);
            }
        }

        // Load files when the page loads
        window.onload = loadUploadedFiles;
    </script>
</head>
<body>
    <h1>Upload Your JSON File</h1>
    <form action="/api/upload" method="POST" enctype="multipart/form-data" onsubmit="handleFormSubmit(event)">
        <label for="file">Choose a JSON file:</label>
        <input type="file" id="file" name="file" accept=".json" required />
        <button type="submit">Upload</button>
    </form>

    <!-- Success Modal -->
    <div id="successModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background-color:white; border:1px solid black; padding:20px; z-index:1000;">
        <h2>Success!</h2>
        <p>Your file has been uploaded successfully.</p>
        <button onclick="closeModal()">Close</button>
    </div>

    <div id="overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); z-index:999;"></div>

    <h2>Uploaded Files</h2>
    <ul id="fileList"></ul>
</body>
</html>
