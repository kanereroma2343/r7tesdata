<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status Check Form</title>
    <style>
        /* Basic styles for the modal */
        #resultModal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
            padding-top: 60px;
        }
        #modalContent {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }
        #closeModal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        #closeModal:hover,
        #closeModal:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>

<form id="statusForm">
    <label for="lastName">Last Name:</label>
    <input type="text" id="lastName" required>
    
    <label for="firstName">First Name:</label>
    <input type="text" id="firstName" required>
    
    <label for="extension">Extension:</label>
    <input type="text" id="extension">
    
    <label for="middleInitial">Middle Initial:</label>
    <input type="text" id="middleInitial">
    
    <label for="dob">Date of Birth:</label>
    <input type="text" id="dob" placeholder="e.g., June 5, 1999" required>
    
    <button type="button" id="checkStatus">Check Status</button>
</form>

<!-- Modal -->
<div id="resultModal">
    <div id="modalContent">
        <span id="closeModal">&times;</span>
        <div id="result"></div>
        <button id="nextEntry" style="display:none;">Next</button>
    </div>
</div>

<script>
document.getElementById('checkStatus').addEventListener('click', function() {
    const lastName = document.getElementById('lastName').value.toUpperCase();
    const firstName = document.getElementById('firstName').value.toUpperCase();
    const extension = document.getElementById('extension').value;
    const middleInitial = document.getElementById('middleInitial').value.toUpperCase();
    const dob = document.getElementById('dob').value;

    fetch('/r7nttc/data.json')
        .then(response => response.json())
        .then(data => {
            const results = data.filter(entry => 
                entry.last_name === lastName && 
                entry.first_name === firstName && 
                (entry.extension === extension || (entry.extension === null && extension === '')) && 
                entry.middle_initial === middleInitial && 
                entry.birthday.toUpperCase() === dob.toUpperCase()
            );

            if (results.length > 0) {
                showModal(results);
            } else {
                alert('No entries found.');
            }
        });
});

function showModal(results) {
    const modal = document.getElementById('resultModal');
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '';

    results.forEach((entry) => {
        const statusColor = getStatusColor(entry.nc_validity);
        resultDiv.innerHTML += `
            <div style="color: ${statusColor};">
                <strong>${entry.first_name} ${entry.middle_initial} ${entry.last_name}</strong><br>
                Qualification: ${entry.qualification}<br>
                Date of Issuance: ${entry.nc_date_issuance}<br>
                Validity: ${entry.nc_validity}<br>
                Status: ${entry.status || 'Active'}
            </div>
        `;
    });

    modal.style.display = 'block';

    document.getElementById('closeModal').onclick = function() {
        modal.style.display = 'none';
    };
}

function getStatusColor(validity) {
    const currentDate = new Date();
    const expiringDate = new Date(validity);
    const threeMonthsFromNow = new Date();
    threeMonthsFromNow.setMonth(currentDate.getMonth() + 3);

    if (expiringDate < currentDate) {
        return 'red';
    } else if (expiringDate <= threeMonthsFromNow) {
        return 'orange';
    } else {
        return 'green';
    }
}
</script>

</body>
</html>
